.\" Copyright (C) 2026 Peter Dey <debian@realmtech.net>
.\" Copying and distribution of this file, with or without modification,
.\" are permitted in any medium without royalty provided this notice is preserved.
.TH STROKE 1 "February 9, 2026" "stroke 0.1.4" "User Commands"
.SH NAME
stroke \- inspect and edit file timestamps
.SH SYNOPSIS
.B stroke
[\fIOPTIONS\fR] \fIFILE\fR ...
.SH DESCRIPTION
\fBstroke\fR prints every timestamp (mtime, atime, ctime) for each
\fIFILE\fR. Supplying any setter option switches the invocation into
mutation mode, where the chosen clocks are edited before the final
per\-file report is printed.
.PP
Setters accept the full GNU \fBparse-datetime\fR grammar, including ISO 8601
forms (e.g. \fB2024-01-01 12:34:56\fR), absolute epochs (\fB@1700000000\fR),
time zones, and natural-language relatives (\fBnow -2 hours\fR,
\fB+3days\fR, \fBnext friday\fR, ...).
.PP
When mutating timestamps, \fBstroke\fR always prints the resulting clocks
unless \fB--quiet\fR is supplied. Dry runs perform every parse,
permission, and capability check and then emit the hypothetical result
without touching disk.
.SH OPTIONS
.TP
\fB-a\fR, \fB--atime\fR=\fISPEC\fR
Set the access time. \fISPEC\fR follows the grammar documented in
.Sx TIMESTAMP SPECIFICATIONS.
.TP
\fB-m\fR, \fB--mtime\fR=\fISPEC\fR
Set the modification time.
.TP
\fB-c\fR, \fB--ctime\fR=\fISPEC\fR
Set the change time. This requires effective root privileges or
CAP_SYS_TIME. See
.Sx NOTES
for details before using this option on multi-tenant systems.
.TP
\fB--copy\fR=\fIREF\fR
Copy all timestamps from the reference file \fIREF\fR. Explicit setters
(\fB-a\fR/\fB-m\fR/\fB-c\fR) override individual clocks after the copy
occurs, allowing fine-grained tweaks such as copying all times but
updating just \fBmtime\fR.
.TP
\fB--dry-run\fR
Perform every parse and permission check but stop before mutating the
filesystem. The per-file report reflects the changes that would occur.
.TP
\fB-p\fR, \fB--preserve-ctime\fR
Keep the change time stable while editing \fBmtime\fR and/or \fBatime\fR.
This option is ignored if \fB--ctime\fR or \fB--copy\fR is used, as those
already request direct ctime updates.
.TP
\fB-l\fR, \fB--symlinks\fR
Operate on symbolic links themselves rather than their targets.
.TP
\fB-f\fR, \fB--force\fR
Skip sanity checks. This is rarely needed; it primarily exists for
debugging pathological filesystems.
.TP
\fB-q\fR, \fB--quiet\fR
Suppress per-file output. Exit status indicates success or failure.
.TP
\fB-v\fR, \fB--verbose\fR
Emit extra diagnostics (warnings, internal decisions).
.TP
\fB-h\fR, \fB--help\fR
Display a short usage summary.
.TP
\fB--version\fR
Print version information.
.SH TIMESTAMP SPECIFICATIONS
\fISPEC\fR strings are parsed via GNU \fBparse-datetime\fR and therefore
understand the same grammar as \fBdate(1)\fR:
.PP
.RS
.IP \(bu 2
Absolute timestamps using calendar forms
(\fB2024-01-31 13:37\fR, \fB20240131133700\fR, \fB2024-01-31T13:37Z\fR, ...).
.IP \(bu
Epoch seconds prefixed by \fB@\fR (e.g. \fB@1700000000\fR).
.IP \(bu
Relative expressions that combine offsets and keywords
(\fBnow -2 hours\fR, \fB+5days\fR, \fByesterday 18:00\fR, ...).
.IP \(bu
Time-zone qualified strings (\fB2024-06-01 10:00 +0200\fR).
.RE
.PP
Numeric offsets are honored even on older libcs. Named time zones
(\fBEurope/Berlin\fR, \fBPST\fR, \fBUTC\fR, etc.) fall back to the
system's current timezone when libc lacks \fBtzalloc\fR support; use
explicit offsets or UTC literals if you need portable results.
.PP
If multiple setters are supplied, each uses the same \fISPEC\fR grammar.
When \fB--copy\fR is combined with explicit setters, \fBstroke\fR first
copies every clock from the reference file and then applies the
overrides.
.SH EXAMPLES
.TP
\fBinspect\fR
\fBstroke /var/log/auth.log\fR
.TP
\fBcopy clocks\fR
\fBstroke --copy backup.tar snapshot.tar\fR
.TP
\fBoverride mtime\fR after copying
\fBstroke --copy=ref.img --mtime 'now' target.img\fR
.TP
\fBdry run a change\fR
\fBstroke --dry-run --mtime '2023-12-24 18:00' *.gif\fR
.SH NOTES
.SS Change time adjustments
POSIX filesystems do not expose a direct interface for modifying
\fBctime\fR. When you request change-time updates (either via
\fB--ctime\fR, \fB--copy\fR, or \fB--preserve-ctime\fR) \fBstroke\fR must
temporarily skew the system clock while it triggers metadata updates
such as \fBchmod\fR. This requires CAP_SYS_TIME or root, and it means
other processes will briefly observe the altered clock.
.PP
Avoid ctime operations on multi-tenant systems where the temporary skew
could be disruptive. On platforms that forbid clock manipulation,
\fBstroke\fR reports an error and leaves ctime untouched.
.SH EXIT STATUS
.TP
0
Success.
.TP
> 0
An error occurred (parse failure, permission error, invalid input, ...).
.SH SEE ALSO
.BR touch (1),
.BR date (1),
.BR parse-datetime (3)
.SH AUTHORS
Originally written by Sören Wellhöfer.
Modernised by Peter Dey.
